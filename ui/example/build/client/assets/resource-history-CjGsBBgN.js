import{r as a,j as e}from"./index-Cpyx2Kcx.js";import{A as O,u as Q,C as X,a as Y,b as Z,c as _,d as ee,L as g,e as F,I as E,B as K,R as se}from"./index.esm-BHZ-heAd.js";import{A as ae,N as te}from"./NavigationToolbar-CLBTHe8_.js";import{E as ie}from"./EventDetailModal-DK6DciOo.js";import{u as re}from"./components-DdpqaNbj.js";function ue(){const[j,v]=re(),[h,G]=a.useState(null),[I,U]=a.useState(null),c=j.get("apiGroup")||"",d=j.get("kind")||"",u=j.get("namespace")||"",m=j.get("name")||"",x=j.get("uid")||"",[t,N]=a.useState(c),[i,y]=a.useState(d),[r,w]=a.useState(u),[l,S]=a.useState(m),[p,k]=a.useState(x),C=a.useMemo(()=>{if(x)return{uid:x};if(c||d||u||m){const s={};return c&&(s.apiGroup=c),d&&(s.kind=d),u&&(s.namespace=u),m&&(s.name=m),s}return null},[c,d,u,m,x]),[n,A]=a.useState(C);a.useEffect(()=>{A(C),N(c),y(d),w(u),S(m),k(x)},[C,c,d,u,m,x]);const D=typeof window<"u"&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1";a.useEffect(()=>{if(D)G(new O({baseUrl:""}));else{const s=sessionStorage.getItem("apiUrl")||"",o=sessionStorage.getItem("token")||void 0;G(new O({baseUrl:s||"",token:o}))}},[D]);const L=a.useMemo(()=>{const s={};return t&&(s.apiGroups=[t]),i&&(s.resourceKinds=[i]),r&&(s.resourceNamespaces=[r]),l&&(s.resourceName=l),s},[t,i,r,l]),{resourceKinds:M,apiGroups:R,resourceNamespaces:H,isLoading:P}=Q(h,{start:"now-30d"},L),V=a.useMemo(()=>R.filter(s=>s.value).map(s=>({value:s.value,label:s.value,count:s.count})),[R]),T=a.useMemo(()=>M.filter(s=>s.value).map(s=>({value:s.value,label:s.value,count:s.count})),[M]),B=a.useMemo(()=>H.filter(s=>s.value).map(s=>({value:s.value,label:s.value,count:s.count})),[H]),$=a.useCallback(s=>{s.preventDefault();const o={},f=new URLSearchParams;p.trim()?(o.uid=p.trim(),f.set("uid",p.trim())):(t&&(o.apiGroup=t,f.set("apiGroup",t)),i&&(o.kind=i,f.set("kind",i)),r&&(o.namespace=r,f.set("namespace",r)),l.trim()&&(o.name=l.trim(),f.set("name",l.trim()))),Object.keys(o).length>0&&(A(o),v(f,{replace:!1}))},[p,t,i,r,l,v]),W=a.useCallback(s=>{U(s)},[]),q=a.useCallback(()=>{A(null),N(""),y(""),w(""),S(""),k(""),v({},{replace:!0})},[v]),z=t||i||r||l||p,b=!!p,J=!!(t||i||r||l);return e.jsxs(ae,{children:[e.jsx(te,{}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Resource History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.uid?e.jsxs("span",{className:"font-mono",children:["UID: ",n.uid]}):e.jsx("span",{children:[n.kind,n.name,n.namespace&&`in ${n.namespace}`,n.apiGroup&&`(${n.apiGroup})`].filter(Boolean).join(" ")})})]}),e.jsx(K,{variant:"outline",onClick:q,children:"New Search"})]}),h&&e.jsx(se,{client:h,resourceFilter:n,startTime:"now-30d",limit:50,showHeader:!1,compact:!1,onActivityClick:W})]}):e.jsxs(X,{className:"max-w-2xl mx-auto",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Resource History"}),e.jsx(_,{children:"Search for a resource to view its change history over time"})]}),e.jsxs(ee,{children:[e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Search by Resource Attributes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"api-group",children:"API Group"}),e.jsx(F,{options:V,value:t,onValueChange:N,placeholder:"Select API group...",searchPlaceholder:"Search API groups...",emptyMessage:"No API groups found",disabled:b,loading:P&&!h,clearable:!0,showAllOption:!1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"kind",children:"Kind"}),e.jsx(F,{options:T,value:i,onValueChange:y,placeholder:"Select kind...",searchPlaceholder:"Search kinds...",emptyMessage:"No kinds found",disabled:b,loading:P&&!h,clearable:!0,showAllOption:!1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"namespace",children:"Namespace"}),e.jsx(F,{options:B,value:r,onValueChange:w,placeholder:"Select namespace...",searchPlaceholder:"Search namespaces...",emptyMessage:"No namespaces found",disabled:b,loading:P&&!h,clearable:!0,showAllOption:!1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"name",children:["Name"," ",e.jsx("span",{className:"font-normal text-muted-foreground text-xs",children:"(partial match)"})]}),e.jsx(E,{id:"name",type:"text",value:l,onChange:s=>S(s.target.value),placeholder:"e.g., api-gateway",disabled:b})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-border"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"or"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Search by Resource UID"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"uid",children:"Resource UID"}),e.jsx(E,{id:"uid",type:"text",value:p,onChange:s=>k(s.target.value),placeholder:"e.g., 550e8400-e29b-41d4-a716-446655440000",className:"font-mono",disabled:J}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"UID provides exact match. When specified, other filters are ignored."})]})]}),e.jsx(K,{type:"submit",disabled:!z,className:"w-full",children:"View History"})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc list-inside",children:[e.jsxs("li",{children:["Dropdowns ",e.jsx("strong",{children:"filter automatically"})," based on other selections"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Name"}),' supports partial matching (e.g., "api" matches "api-gateway")']}),e.jsx("li",{children:"Combine filters to narrow down results (e.g., Kind + Namespace)"}),e.jsxs("li",{children:["Find a resource's UID with:"," ",e.jsxs("code",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:["kubectl get <kind> <name> -o jsonpath='","{.metadata.uid}","'"]})]})]})]})]})]}),I&&e.jsx(ie,{title:"Activity Details",data:I,onClose:()=>U(null)})]})}export{ue as default};
